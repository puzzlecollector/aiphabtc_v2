{% extends 'base.html' %}
{% block content %}
<style>
    .responsive-video {
        width: 100%;
        height: 450px; /* For video tags, ensures proper aspect ratio */
        max-width: 800px; /* Optional: limits video size */
        display: block;
        margin: auto;
    }
</style>
<div class="container my-3">
    <form method="post" class="post-form">
        {% csrf_token %}
        {% include "form_errors.html" %}
        <div class="form-group">
            <label for="content">Answer Content</label>
            <div id="editor" style="height: 300px;">{{ form.content.value|default_if_none:''|safe }}</div> <!-- Placeholder for Quill editor -->
            <textarea class="form-control" name="content" id="content" rows="10" style="display: none;">
                {{ form.content.value|default_if_none:'' }}
            </textarea>
        </div>
        <button type="submit" class="btn btn-primary">Post</button>
    </form>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
            toolbar: [
                ['bold', 'italic', 'underline', 'strike'],
                ['blockquote', 'code-block'],
                [{ 'header': 1 }, { 'header': 2 }],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'script': 'sub'}, { 'script': 'super' }],
                [{ 'indent': '-1'}, { 'indent': '+1' }],
                [{ 'direction': 'rtl' }],
                [{ 'size': ['small', false, 'large', 'huge'] }],
                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'font': [] }],
                [{ 'align': [] }],
                ['clean'],
                ['link', 'image', 'video'],
                ['formula']
            ],
            formula: true
        }
    });

    // Custom blot for embedding videos
    var BlockEmbed = Quill.import('blots/block/embed');
    class VideoBlot extends BlockEmbed {
        static create(value) {
            let node = document.createElement('iframe');
            node.setAttribute('src', value);
            node.setAttribute('frameborder', '0');
            node.setAttribute('allowfullscreen', 'true');
            node.setAttribute('width', '100%');
            node.style.height = '450px'; // Set height to maintain aspect ratio
            return node;
        }

        static value(node) {
            return node.getAttribute('src');
        }
    }

    VideoBlot.blotName = 'video';
    VideoBlot.tagName = 'iframe';
    Quill.register(VideoBlot);

    // Load existing content into Quill
    const contentField = document.querySelector('textarea[name="content"]');
    if (contentField) {
        quill.clipboard.dangerouslyPasteHTML(contentField.value);
    }

    // Ensure form submission carries over the rich text content
    var form = document.querySelector('form');
    form.onsubmit = function() {
        contentField.value = quill.root.innerHTML;
    };
  });
</script>
{% endblock %}